<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Univers 3D - Explorateur</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }

        #canvas {
            display: block;
            width: 100%;
            height: 100vh;
        }

        .ui {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            pointer-events: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(100, 200, 255, 0.8);
        }

        .btn-return {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-return:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(100, 200, 255, 0.8);
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            pointer-events: auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(100, 200, 255, 0.5);
            z-index: 100;
        }

        .control-label {
            font-size: 12px;
            margin-bottom: 8px;
            color: #64c8ff;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 8px 12px;
            background: #333;
            border: 1px solid #64c8ff;
            color: #64c8ff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #64c8ff;
            color: #000;
        }

        .btn.active {
            background: #64c8ff;
            color: #000;
        }

        .info-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(100, 200, 255, 0.5);
            pointer-events: auto;
            max-width: 300px;
            z-index: 100;
        }

        .info-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: #64c8ff;
        }

        .info-text {
            font-size: 12px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="ui">
        <div class="header">
            <div class="title">üöÄ Explorateur Univers 3D</div>
            <button class="btn-return" onclick="window.location.href='/'; return false;">‚Üê Retour au Chat</button>
        </div>

        <div class="info-panel">
            <div class="info-title" id="objectName">Univers</div>
            <div class="info-text" id="objectInfo">Cliquez sur les objets pour explorer</div>
        </div>

        <div class="controls">
            <div class="control-label">üìç NAVIGATION</div>
            <div class="btn-group">
                <button class="btn active" onclick="selectMode('orbit')">Orbite</button>
                <button class="btn" onclick="selectMode('fly')">Voler</button>
                <button class="btn" onclick="selectMode('reset')">R√©initialiser</button>
            </div>
            <div class="control-label">‚≠ê OBJETS</div>
            <div class="btn-group">
                <button class="btn" onclick="focusOn('sun')">Soleil</button>
                <button class="btn" onclick="focusOn('earth')">Terre</button>
                <button class="btn" onclick="focusOn('galaxy')">Galaxie</button>
            </div>
            <div class="control-label">üí´ AFFICHAGE</div>
            <div class="btn-group">
                <button class="btn" onclick="toggleOrbits()">Orbites</button>
                <button class="btn" onclick="toggleStars()">√âtoiles</button>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer, controls;
        let planets = {};
        let orbitLines = [];
        let currentMode = 'orbit';
        let showOrbits = true;
        let showStars = true;

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
            camera.position.set(0, 50, 100);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFShadowShadowMap;
            document.body.appendChild(renderer.domElement);

            // Lights
            const sunLight = new THREE.PointLight(0xfdb813, 2, 300);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            scene.add(sunLight);

            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);

            // Stars background
            createStarfield();

            // Create objects
            createSun();
            createPlanets();
            createGalaxy();

            // Simple camera control (mouse drag)
            setupCameraControl();

            // Handle resize
            window.addEventListener('resize', onWindowResize);

            // Start animation
            animate();
        }

        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 10000;
            const positions = new Float32Array(starCount * 3);

            for (let i = 0; i < starCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 50000;
                positions[i + 1] = (Math.random() - 0.5) * 50000;
                positions[i + 2] = (Math.random() - 0.5) * 50000;
            }

            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 10 });
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        function createSun() {
            const geometry = new THREE.SphereGeometry(20, 32, 32);
            const material = new THREE.MeshBasicMaterial({
                color: 0xfdb813,
                emissive: 0xfdb813,
            });
            const sun = new THREE.Mesh(geometry, material);
            sun.castShadow = true;
            sun.userData = {
                name: 'Soleil',
                description: 'Notre √©toile, c≈ìur du syst√®me solaire\n\nMasse: 1.989 √ó 10¬≥‚Å∞ kg\nDiam√®tre: 1 391 000 km\nTemps de rotation: 25.3 jours'
            };
            scene.add(sun);
            planets.sun = sun;
        }

        function createPlanets() {
            const planetsData = [
                { name: 'Mercure', size: 4, distance: 40, speed: 0.04, color: 0x8c7853 },
                { name: 'V√©nus', size: 7, distance: 60, speed: 0.015, color: 0xffc649 },
                { name: 'Terre', size: 7.5, distance: 100, speed: 0.01, color: 0x2e8fdb },
                { name: 'Mars', size: 5, distance: 140, speed: 0.008, color: 0xd63d3d },
                { name: 'Jupiter', size: 20, distance: 200, speed: 0.002, color: 0xc88b3a },
                { name: 'Saturne', size: 18, distance: 260, speed: 0.0009, color: 0xf4d47c },
            ];

            planetsData.forEach(data => {
                const geometry = new THREE.SphereGeometry(data.size, 32, 32);
                const material = new THREE.MeshStandardMaterial({
                    color: data.color,
                    roughness: 0.8,
                    metalness: 0.2,
                });
                const planet = new THREE.Mesh(geometry, material);
                planet.castShadow = true;
                planet.receiveShadow = true;
                planet.userData = {
                    name: data.name,
                    distance: data.distance,
                    speed: data.speed,
                    angle: Math.random() * Math.PI * 2,
                    description: `${data.name}\n\nDistance: ${data.distance * 1000000} km\nVitesse orbitale: ${data.speed * 100} UA/an`
                };
                scene.add(planet);
                planets[data.name.toLowerCase()] = planet;

                // Orbit line
                if (showOrbits) {
                    const orbitGeometry = new THREE.BufferGeometry();
                    const orbitPoints = [];
                    for (let i = 0; i <= 64; i++) {
                        const angle = (i / 64) * Math.PI * 2;
                        orbitPoints.push(
                            Math.cos(angle) * data.distance,
                            0,
                            Math.sin(angle) * data.distance
                        );
                    }
                    orbitGeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(orbitPoints), 3));
                    const orbitMaterial = new THREE.LineBasicMaterial({ color: 0x444444, transparent: true, opacity: 0.5 });
                    const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
                    scene.add(orbitLine);
                    orbitLines.push(orbitLine);
                }
            });
        }

        function createGalaxy() {
            const galaxyGeometry = new THREE.BufferGeometry();
            const galaxyCount = 5000;
            const positions = new Float32Array(galaxyCount * 3);

            for (let i = 0; i < galaxyCount * 3; i += 3) {
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 200;
                positions[i] = Math.cos(angle) * distance;
                positions[i + 1] = (Math.random() - 0.5) * 50;
                positions[i + 2] = Math.sin(angle) * distance;
            }

            galaxyGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const galaxyMaterial = new THREE.PointsMaterial({ color: 0xf0ff00, size: 2 });
            const galaxy = new THREE.Points(galaxyGeometry, galaxyMaterial);
            galaxy.userData = {
                name: 'Voie Lact√©e',
                description: 'Notre galaxie spirale\n\nDiam√®tre: 100 000 ann√©es-lumi√®re\n√âtoiles: 100 √† 400 milliards\n√Çge: ~13.6 milliards d\'ann√©es'
            };
            scene.add(galaxy);
            planets.galaxy = galaxy;
        }

        function setupCameraControl() {
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            document.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging && currentMode === 'orbit') {
                    const deltaX = e.clientX - previousMousePosition.x;
                    const deltaY = e.clientY - previousMousePosition.y;

                    const radius = Math.sqrt(camera.position.x ** 2 + camera.position.y ** 2 + camera.position.z ** 2);
                    let theta = Math.atan2(camera.position.z, camera.position.x);
                    let phi = Math.acos(camera.position.y / radius);

                    theta -= deltaX * 0.01;
                    phi -= deltaY * 0.01;
                    phi = Math.max(0.1, Math.min(Math.PI - 0.1, phi));

                    camera.position.x = radius * Math.sin(phi) * Math.cos(theta);
                    camera.position.y = radius * Math.cos(phi);
                    camera.position.z = radius * Math.sin(phi) * Math.sin(theta);
                    camera.lookAt(0, 0, 0);
                }

                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });

            // Wheel zoom
            document.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomSpeed = 1.1;
                const direction = camera.position.clone().normalize();
                const distance = camera.position.length();
                
                if (e.deltaY > 0) {
                    camera.position.copy(direction.multiplyScalar(distance * zoomSpeed));
                } else {
                    camera.position.copy(direction.multiplyScalar(distance / zoomSpeed));
                }
                camera.lookAt(0, 0, 0);
            }, { passive: false });

            // Click on objects
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('btn') || e.target.classList.contains('btn-return')) return;
                
                const raycaster = new THREE.Raycaster();
                const mouse = new THREE.Vector2();
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);
                const objects = Object.values(planets);
                const intersects = raycaster.intersectObjects(objects);

                if (intersects.length > 0) {
                    const selected = intersects[0].object;
                    if (selected.userData.name) {
                        document.getElementById('objectName').textContent = selected.userData.name;
                        document.getElementById('objectInfo').textContent = selected.userData.description;
                        focusOn(selected.userData.name.toLowerCase());
                    }
                }
            });
        }

        function focusOn(name) {
            const obj = planets[name];
            if (!obj) return;

            const distance = obj.geometry.parameters.radius * 5;
            const direction = new THREE.Vector3(1, 0.5, 1).normalize();
            const targetPos = direction.multiplyScalar(distance);

            const startPos = camera.position.clone();
            const startTime = Date.now();
            const duration = 1500;

            const animateCamera = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);

                camera.position.lerpVectors(startPos, targetPos, progress);
                camera.lookAt(obj.position);

                if (progress < 1) {
                    requestAnimationFrame(animateCamera);
                }
            };

            animateCamera();
        }

        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function toggleOrbits() {
            showOrbits = !showOrbits;
            orbitLines.forEach(line => line.visible = showOrbits);
        }

        function toggleStars() {
            showStars = !showStars;
            scene.children.forEach(obj => {
                if (obj instanceof THREE.Points && obj !== planets.galaxy) {
                    obj.visible = showStars;
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);

            // Animate planets
            Object.entries(planets).forEach(([key, planet]) => {
                if (planet.userData.speed && planet.userData.distance) {
                    planet.userData.angle += planet.userData.speed;
                    planet.position.x = Math.cos(planet.userData.angle) * planet.userData.distance;
                    planet.position.z = Math.sin(planet.userData.angle) * planet.userData.distance;
                    planet.rotation.y += 0.005;
                }
            });

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Start when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>

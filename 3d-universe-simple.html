<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåå 3D Univers - Plan√®tes & Voie Lact√©e</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
            background: #000814;
            color: #fff;
            overflow: hidden;
        }
        #canvas { display: block; }
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #00d4ff, #0099ff);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            z-index: 200;
            text-decoration: none;
            transition: all 0.3s;
        }
        .back-btn:hover {
            background: linear-gradient(135deg, #00f5ff, #00ccff);
            transform: scale(1.1);
            box-shadow: 0 0 20px #00d4ff;
        }
        .title {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
            text-shadow: 0 0 20px #00d4ff;
            z-index: 100;
            pointer-events: none;
        }
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 8, 20, 0.95);
            padding: 40px 60px;
            border-radius: 15px;
            text-align: center;
            border: 3px solid #00d4ff;
            z-index: 1000;
        }
        .loading h2 {
            color: #00d4ff;
            margin-bottom: 20px;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0,212,255,0.3);
            border-top: 4px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="title">üåå UNIVERS 3D</div>
    <a href="http://localhost:3000" class="back-btn">‚Üê Retour au Chatbot</a>
    
    <div class="loading" id="loading">
        <h2>üåå Initialisation 3D...</h2>
        <div class="spinner"></div>
        <p>Chargement de l'univers...</p>
    </div>

    <canvas id="canvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@r128/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        console.log('‚úÖ Scripts charg√©s');
        
        let scene, camera, renderer, controls;
        let planets = [];
        let autoRotate = true;

        function init() {
            console.log('üöÄ Initialisation 3D START');
            
            if (typeof THREE === 'undefined') {
                console.error('‚ùå THREE.js non charg√©');
                document.getElementById('loading').innerHTML = '<h2>‚ùå Erreur: Three.js non charg√©</h2><p>Rechargez la page</p>';
                return;
            }

            try {
                // Scene
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000814);
                scene.fog = new THREE.Fog(0x000814, 20000, 50000);
                console.log('‚úÖ Scene cr√©√©e');

                // Camera
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
                camera.position.set(500, 300, 500);
                console.log('‚úÖ Camera cr√©√©e');

                // Renderer
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.shadowMap.enabled = true;
                
                const canvas = document.getElementById('canvas');
                canvas.parentNode.insertBefore(renderer.domElement, canvas);
                canvas.remove();
                console.log('‚úÖ Renderer cr√©√©');

                // Controls
                if (typeof THREE.OrbitControls !== 'undefined') {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.autoRotate = autoRotate;
                    controls.autoRotateSpeed = 1;
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    console.log('‚úÖ OrbitControls cr√©√©s');
                }

                // Lights
                const sunLight = new THREE.PointLight(0xffffff, 2, 100000);
                sunLight.position.set(0, 0, 0);
                sunLight.castShadow = true;
                scene.add(sunLight);

                const ambientLight = new THREE.AmbientLight(0x333333);
                scene.add(ambientLight);
                console.log('‚úÖ Lumi√®res ajout√©es');

                // Cr√©er le Soleil
                createSun();
                
                // Cr√©er les plan√®tes
                createPlanets();
                
                // Cr√©er le champ d'√©toiles
                createStarfield();
                
                console.log('‚úÖ Objets 3D cr√©√©s');

                // Event listeners
                window.addEventListener('resize', onWindowResize);

                // Cacher loader
                document.getElementById('loading').style.display = 'none';
                console.log('‚úÖ Loader cach√©');

                // D√©marrer animation
                animate();
                console.log('‚úÖ Animation d√©marr√©e - 3D PR√äTE!');

            } catch (error) {
                console.error('‚ùå ERREUR:', error);
                document.getElementById('loading').innerHTML = `<h2>‚ùå Erreur 3D</h2><p>${error.message}</p>`;
            }
        }

        function createSun() {
            const geometry = new THREE.IcosahedronGeometry(50, 32);
            const material = new THREE.MeshStandardMaterial({
                color: 0xfdb813,
                emissive: 0xfdb813,
                emissiveIntensity: 1,
                roughness: 0.4,
            });
            const sun = new THREE.Mesh(geometry, material);
            sun.castShadow = true;
            sun.receiveShadow = true;

            const glowGeometry = new THREE.IcosahedronGeometry(52, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xfdb813,
                transparent: true,
                opacity: 0.2,
                side: THREE.BackSide,
            });
            const glowMesh = new THREE.Mesh(glowGeometry, glowMaterial);
            sun.add(glowMesh);

            scene.add(sun);
        }

        function createPlanets() {
            const planetsData = [
                { name: 'Mercure', size: 3.8, distance: 60, color: 0x8c7853, speed: 0.04 },
                { name: 'V√©nus', size: 9.5, distance: 110, color: 0xffc649, speed: 0.015 },
                { name: 'Terre', size: 10, distance: 150, color: 0x4da6ff, speed: 0.01 },
                { name: 'Mars', size: 5.3, distance: 220, color: 0xe27b58, speed: 0.008 },
                { name: 'Jupiter', size: 110, distance: 780, color: 0xdaa520, speed: 0.002 },
                { name: 'Saturne', size: 95, distance: 1430, color: 0xf4a460, speed: 0.0009, rings: true },
                { name: 'Uranus', size: 40, distance: 2870, color: 0x4fd0e7, speed: 0.0004 },
                { name: 'Neptune', size: 38, distance: 4497, color: 0x4166f5, speed: 0.0001 }
            ];

            planetsData.forEach((data) => {
                // Orbite
                const orbitGeometry = new THREE.BufferGeometry();
                const orbitPoints = [];
                for (let i = 0; i <= 64; i++) {
                    const angle = (i / 64) * Math.PI * 2;
                    orbitPoints.push(
                        Math.cos(angle) * data.distance,
                        0,
                        Math.sin(angle) * data.distance
                    );
                }
                orbitGeometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(orbitPoints), 3));
                const orbitMaterial = new THREE.LineBasicMaterial({ color: 0x444444 });
                const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
                scene.add(orbit);

                // Plan√®te
                const geometry = new THREE.IcosahedronGeometry(Math.max(data.size, 5), 32);
                const material = new THREE.MeshStandardMaterial({
                    color: data.color,
                    roughness: 0.7,
                    metalness: 0.1,
                });
                const planet = new THREE.Mesh(geometry, material);
                planet.position.x = data.distance;
                planet.castShadow = true;
                planet.receiveShadow = true;

                // Anneaux Saturne
                if (data.rings) {
                    const ringGeometry = new THREE.RingGeometry(data.size * 1.5, data.size * 2.5, 64);
                    const ringMaterial = new THREE.MeshStandardMaterial({
                        color: 0xd4a574,
                        roughness: 0.5,
                        side: THREE.DoubleSide,
                    });
                    const rings = new THREE.Mesh(ringGeometry, ringMaterial);
                    rings.rotation.x = Math.PI * 0.4;
                    planet.add(rings);
                }

                scene.add(planet);
                planets.push({
                    mesh: planet,
                    data: data,
                    angle: Math.random() * Math.PI * 2,
                });
            });
        }

        function createStarfield() {
            const positions = new Float32Array(50000 * 3);
            for (let i = 0; i < 50000; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 100000;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 100000;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 100000;
            }

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 30,
                sizeAttenuation: true,
            });

            scene.add(new THREE.Points(geometry, material));
        }

        function animate() {
            requestAnimationFrame(animate);

            planets.forEach((planet) => {
                planet.angle += planet.data.speed;
                planet.mesh.position.x = Math.cos(planet.angle) * planet.data.distance;
                planet.mesh.position.z = Math.sin(planet.angle) * planet.data.distance;
                planet.mesh.rotation.y += 0.003;
            });

            if (controls) controls.update();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Lancer init quand tout est pr√™t
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
